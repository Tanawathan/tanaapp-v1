# AI 聊天系統 - 人性化互動功能

## 📱 新增功能概覽

### 1. 已讀狀態 (Read Status) ✓✓
- **隨機延遲 0-3 秒**：模擬真實人類看到訊息的時間差
- **視覺指示**：
  - `✓ 已送達`：消息已發送但未讀取
  - `✓✓ 已讀`：AI 助手已讀取消息
- **頂部狀態**：標題欄會顯示「已讀 - 泰式餐廳助手」

### 2. 智能延遲系統 ⏰
基於字數長度計算真實的閱讀和回覆時間：

#### 閱讀延遲計算
```typescript
閱讀速度: 50字符/秒
基礎延遲: Math.max(1000ms, (字數 / 50) * 1000)
隨機波動: 0.5x - 1.5x
最大延遲: 8秒
```

#### 回覆延遲計算
```typescript
處理速度: 30字符/秒
思考時間: 500-2500ms 隨機
基礎延遲: Math.max(800ms, (字數 / 30) * 1000)
隨機波動: 0.7x - 1.3x
最大延遲: 10秒
```

### 3. 打字狀態指示 ⌨️
- **動畫效果**：三個小球的彈跳動畫
- **狀態文字**：「阿狸正在輸入中...」
- **預估時間**：內部計算回覆所需時間
- **頂部顯示**：標題欄同步顯示打字狀態

## 🎭 互動流程

### 用戶發送訊息後的完整流程：

1. **立即顯示** - 用戶消息出現，標記為「✓ 已送達」

2. **隨機延遲** (0-3秒) - 模擬 AI 注意到新訊息

3. **標記已讀** - 消息狀態變更為「✓✓ 已讀」，頂部顯示「已讀」

4. **計算閱讀時間** - 基於用戶訊息長度計算閱讀時間

5. **閱讀延遲** - AI 模擬閱讀用戶訊息的時間

6. **開始打字** - 顯示打字動畫，頂部狀態變為「正在輸入中...」

7. **AI 處理** - 後台調用 OpenAI API 生成回覆（無額外提示）

8. **等待剩餘時間** - 確保總回覆時間符合計算的延遲

9. **顯示回覆** - 停止打字動畫，顯示 AI 回覆

## 📊 延遲時間範例

| 用戶訊息長度 | 預期閱讀時間 | 預期回覆時間 | 總延遲範圍 |
|------------|------------|------------|-----------|
| 10字 "我想點菜" | 1-1.5秒 | 2-4秒 | 3-5.5秒 |
| 30字 "我想要一份泰式炒河粉，不要太辣，謝謝" | 1-2秒 | 3-6秒 | 4-8秒 |
| 60字 長文訊息 | 2-3秒 | 4-8秒 | 6-11秒 |

## 🎨 視覺設計

### 已讀狀態
- **已送達**：淡橘色 `✓` 符號
- **已讀取**：橘色 `✓✓` 符號

### 打字動畫
- **三個圓點**：灰色小球
- **彈跳效果**：150ms 間隔的連續動畫
- **背景**：白色對話框，灰色邊框

### 狀態指示
- **頂部標題**：動態顯示當前狀態
- **輸入框**：在 AI 回覆過程中禁用

## 🔧 技術實現

### 回調函數系統
```typescript
// 設定已讀狀態回調
aiChatManager.setReadStatusCallback((status: ReadStatus) => {
  // 更新 UI 顯示已讀狀態
})

// 設定打字狀態回調  
aiChatManager.setTypingStatusCallback((status: TypingStatus) => {
  // 更新 UI 顯示打字動畫
})
```

### 狀態管理
- **ReadStatus**: `{ isRead: boolean, readAt?: Date }`
- **TypingStatus**: `{ isTyping: boolean, estimatedTime?: number }`
- **Message**: 新增 `isRead` 和 `readAt` 欄位

## 🚀 使用體驗提升

1. **真實感**：模擬人類閱讀和思考的時間
2. **可預期性**：用戶知道 AI 何時看到和處理訊息
3. **互動性**：視覺反饋讓對話更生動
4. **專業感**：類似主流聊天應用的功能
5. **自然感**：移除機械化提示，只顯示自然的打字狀態

## 🎯 測試建議

1. **短訊息測試**：「你好」、「菜單」等簡單訊息
2. **中等訊息**：「我想要點一些泰式菜，有什麼推薦的嗎？」
3. **長訊息測試**：詳細的訂餐需求或複雜問題
4. **連續訊息**：測試狀態重置和處理順序

觀察每個階段的延遲時間和視覺反饋是否符合預期！
